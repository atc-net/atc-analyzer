# ðŸ“ ATC230: Require exactly one blank line between code blocks

## ðŸ“‚ Category

Style

## âš ï¸ Severity

Warning

## ðŸ“– Description

Consecutive code blocks should be separated by exactly one blank line for improved readability. This rule ensures consistent spacing between control flow statements like `if`, `for`, `foreach`, `while`, `do`, `switch`, `try`, `using`, `lock`, `fixed`, and `checked`.

## ðŸ“‹ Rules

1. **Code blocks**: The following statements are considered code blocks:
   - `if` statements
   - `for` statements
   - `foreach` statements
   - `while` statements
   - `do` statements
   - `switch` statements
   - `try` statements
   - `using` statements
   - `lock` statements
   - `fixed` statements
   - `checked` statements

2. **Blank line requirement**: When two consecutive code blocks appear in sequence, there must be exactly one blank line between them

3. **Diagnostics**:
   - Missing blank line: Reports when there is no blank line between consecutive code blocks
   - Excessive blank lines: Reports when there is more than one blank line between code blocks

4. **Does NOT apply to**:
   - Connected blocks like `if-else` chains (no blank line required between `if` and `else`)
   - `try-catch-finally` blocks (no blank line required between `try`, `catch`, and `finally`)
   - Single statements without braces
   - Generated code files

## ðŸ’¡ Motivation

Consistent spacing between code blocks improves readability by:

- **Visual separation**: Creates clear boundaries between logical sections of code
- **Reduced cognitive load**: Makes it easier to scan and understand code structure
- **Consistency**: Ensures uniform formatting across the codebase
- **Code reviews**: Makes it easier to spot structural changes in diffs

## ðŸ“ Examples

### Scenario 1: Missing blank line between code blocks

```csharp
// non-compliant - no blank line between if statements
if (DateTime.Now.Hour > 12)
{
    Console.WriteLine("Afternoon");
}
if (DateTime.Now.Hour < 6)
{
    Console.WriteLine("Early morning");
}

// compliant - exactly one blank line between if statements
if (DateTime.Now.Hour > 12)
{
    Console.WriteLine("Afternoon");
}

if (DateTime.Now.Hour < 6)
{
    Console.WriteLine("Early morning");
}
```

### Scenario 2: Too many blank lines between code blocks

```csharp
// non-compliant - too many blank lines (2+)
if (DateTime.Now.Hour > 12)
{
    Console.WriteLine("Afternoon");
}


if (DateTime.Now.Hour < 6)
{
    Console.WriteLine("Early morning");
}

// compliant - exactly one blank line
if (DateTime.Now.Hour > 12)
{
    Console.WriteLine("Afternoon");
}

if (DateTime.Now.Hour < 6)
{
    Console.WriteLine("Early morning");
}
```

### Scenario 3: Mixed code block types

```csharp
// compliant - one blank line between for and while
for (int i = 0; i < 3; i++)
{
    Console.WriteLine($"Iteration {i}");
}

while (false)
{
    // This won't execute
}
```

### Scenario 4: If-else chains (no blank line needed)

```csharp
// compliant - if-else chain has NO blank line (logically connected)
if (value > 0)
{
    Console.WriteLine("Positive");
}
else if (value < 0)
{
    Console.WriteLine("Negative");
}
else
{
    Console.WriteLine("Zero");
}
```

### Scenario 5: Try-catch-finally (no blank line needed)

```csharp
// compliant - try-catch-finally has NO blank line (logically connected)
try
{
    Console.WriteLine("In try block");
}
catch (Exception ex)
{
    Console.WriteLine($"Caught: {ex.Message}");
}
finally
{
    Console.WriteLine("In finally block");
}
```

### Scenario 6: Code block with comments

```csharp
// compliant - comment between blocks with one blank line before the comment
if (true)
{
    Console.WriteLine("First block");
}

// This comment is allowed, with one blank line before it
if (true)
{
    Console.WriteLine("Second block");
}
```

## ðŸ¤– Generated Code

This rule automatically skips analysis of generated code. Generated code is identified by:

1. **Auto-generated Headers**: Files containing "auto-generated" in header comments (case-insensitive)
2. **GeneratedCode Attribute**: Classes or types marked with `[GeneratedCode]` attribute

## ðŸ”§ Code Fix

A code fix is available that automatically adds or removes blank lines as needed.

**How to apply:**

1. Position cursor on the code block that triggered the diagnostic
2. Click the lightbulb (ðŸ’¡) or press `Ctrl+.` (Windows/Linux) or `Cmd+.` (Mac)
3. Select the appropriate fix:
   - **"Add blank line before code block"** - when a blank line is missing
   - **"Remove extra blank lines before code block"** - when there are too many blank lines

The code fix will:

- Add exactly one blank line when none exists
- Remove extra blank lines, leaving exactly one

**Batch fix:**
You can apply the fix to multiple files at once:

1. Right-click on the project or solution in Solution Explorer
2. Select "Analyze and Code Cleanup" > "Run Code Cleanup"
3. All blank line issues will be fixed automatically

## ðŸ”€ Overlap with StyleCop Rules

This rule has functional overlap with two StyleCop Analyzers rules:

| StyleCop Rule | Description | ATC230 Advantage |
|---------------|-------------|------------------|
| [SA1507](https://github.com/DotNetAnalyzers/StyleCopAnalyzers/blob/master/documentation/SA1507.md) | Code should not contain multiple blank lines in a row | ATC230 provides a code fix |
| [SA1513](https://github.com/DotNetAnalyzers/StyleCopAnalyzers/blob/master/documentation/SA1513.md) | Closing brace should be followed by blank line | ATC230 provides a code fix |

**Key advantage of ATC230:** Unlike SA1507 and SA1513, this rule includes a **code fix provider** that can automatically correct both scenarios:

- Adds a blank line when one is missing (SA1513 scenario)
- Removes extra blank lines when there are too many (SA1507 scenario)

This makes ATC230 more practical for large codebases where manual fixes would be time-consuming.

### Configuration recommendation

If you enable ATC230, consider disabling the overlapping StyleCop rules to avoid duplicate diagnostics:

```editorconfig
[*.cs]
# Disable StyleCop rules that overlap with ATC230
dotnet_diagnostic.SA1507.severity = none
dotnet_diagnostic.SA1513.severity = none

# Enable ATC230 (has code fix for both scenarios)
dotnet_diagnostic.ATC230.severity = warning
```

## ðŸ”— Related Rules

### Other Style Rules

- [ATC201: Single parameter should be formatted correctly](ATC201.md) - Single parameter formatting
- [ATC202: Multi parameters should be separated on individual lines](ATC202.md) - Multi-parameter formatting
- [ATC203: Method chains with 2 or more calls should be placed on separate lines](ATC203.md) - Method chain formatting
- [ATC210: Use expression body syntax when appropriate](ATC210.md) - Expression body formatting
- [ATC220: Use global usings for all namespaces](ATC220.md) - Global usings (strict policy)
- [ATC221: Use global usings for common namespaces](ATC221.md) - Global usings (lenient policy)
